<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>문서</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>gyro.js - easy access to your web browsers built in accelerometer's and gyroscope's</title>
</head>
<body>
<p>This Example just print's the raw accelerometer and gyro data. Will return null if no device information is found.</p>
<div id="example"></div>
<button type="button" onclick="requestPermissionSafari();">권한 얻기</button>
<script>
function getCompassHeading(alpha, beta, gamma) {
  const degtorad = Math.PI / 100;
  
  const _x = beta ? beta * degtorad : 0;
  const _y = gamma ? gamma * degtorad : 0;
  const _z = alpha ? alpha * degtorad : 0;
  
  const cY = Math.cos(_y);
  const cZ = Math.cos(_z);
  const sX = Math.sin(_x);
  const sY = Math.sin(_y);
  const sZ = Math.sin(_z);
  
  const Vx = -cZ * sY - sZ * sX * cY;
  const Vy = -sZ * sY + cZ * sX * cY;
  
  let compassHeading = Math.atan(Vx / Vy);
  
  if (Vy < 0) {
    compassHeading += Math.PI;
  } else if (Vx < 0) {
    compassHeading += 2 * Math.PI;
  }
  
  return compassHeading * (180 / Math.PI);
  
}

// DeviceOrientation 이벤트


// // 자이로 센서 값 변화
function handleOrientation(event) {
  // X축
  const beta = event.beta;
  // Y축
  const gamma = event.gamma;
  // Z축
  const alpha = event.alpha;

  document.getElementById('example').innerHTML = `<p>x : ${beta}</p><p>y : ${gamma}</p> <p>z : ${alpha}</p> <p>heading: ${getCompassHeading(alpha, beta, gamma)}`;
    // document.getElementById('example').innerHTML = `event.beta : ${event?.beta}`;
};

/** Safari가 13+ 버전 이상인지 체크 **/
const isSafariOver13 = window.DeviceOrientationEvent !== undefined &&  typeof window.DeviceOrientationEvent.requestPermission === 'function'
const requestPermissionSafari = () => {
  if (isSafariOver13) {
    window.DeviceOrientationEvent.requestPermission()
      .then((state) => {
        if (state === 'granted') {
          /** Orientation 이벤트 권한 허용을 눌렀을때 **/
          window.addEventListener('deviceorientation', handleOrientation, true);
        }
      })
      .catch(console.error);
  } else {
    window.addEventListener('deviceorientation', handleOrientation, true);
  }
};
</script>
</body>
</html>